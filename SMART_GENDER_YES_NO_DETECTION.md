# שיפור הפרסר - זיהוי חכם של מגדר ו-"כן/לא"

## מה השתנה?

הוספתי זיהוי **חכם** של מגדר ושל "כן/לא" לתכונת "הדבק וייבא".

## הבעיה שנפתרה

כשמשתמש כתב:
```
אורית יחיאל 04/04/2010 נקבה
```

המערכת לא זיהתה את המגדר, והוא לא נשמר.

כמו כן, לא היה ברור איך לציין "אחרי שקיעה" בצורה פשוטה.

## הפתרון

### 1. זיהוי מגדר אוטומטי

הוספתי **מילות מפתח** למגדר בעברית ואנגלית:

#### זכר (Male):
- עברית: `זכר`, `ז`, `בן`
- אנגלית: `male`, `m`, `boy`

#### נקבה (Female):
- עברית: `נקבה`, `נ`, `בת`
- אנגלית: `female`, `f`, `girl`

### 2. "כן/לא" לאחרי שקיעה

הוספתי `כן` ו-`yes` למילות המפתח של "אחרי שקיעה":

- **ברירת מחדל:** לא (לא צריך לציין כלום)
- **עבור "כן":** כתוב `כן` או `yes`

**מילות מפתח אחרות עדיין עובדות:**
- בלילה, ערב, שקיעה, אחה"צ, PM וכו'

## דוגמאות שימוש

### מגדר:
```
✅ משה כהן 15/03/1990 זכר
✅ שרה לוי 22.05.85 נקבה
✅ דוד ישראלי 10/12/1985 male
✅ רחל אברהם 1992-08-03 female
✅ יוסי לוי 5.6.78 ז
✅ מרים כהן 3.4.82 נ
```

### אחרי שקיעה:
```
✅ משה כהן 15/03/1990 כן
✅ שרה לוי 22.05.85 yes
✅ דוד ישראלי 10/12/1985 נקבה כן
✅ רחל אברהם 1992-08-03 female yes (הערה)

// גם עדיין עובד:
✅ יוסי לוי 5.6.78 בלילה
✅ מרים כהן 3.4.82 ערב
```

### שילוב:
```
✅ אורית יחיאל 04/04/2010 נקבה כן
   → שם: אורית יחיאל
   → תאריך: 2010-04-04
   → מגדר: נקבה
   → אחרי שקיעה: כן

✅ דני לוי 15/03/1995 זכר
   → שם: דני לוי
   → תאריך: 1995-03-15
   → מגדר: זכר
   → אחרי שקיעה: לא (ברירת מחדל)
```

## שינויים טכניים

### 1. `textParser.ts`

**הוספת מילות מפתח:**
```typescript
const AFTER_SUNSET_KEYWORDS = [
  // ... מילות קיימות
  'כן',
  'yes',
];

const GENDER_KEYWORDS = {
  male: ['זכר', 'ז', 'בן', 'male', 'm', 'boy'],
  female: ['נקבה', 'נ', 'בת', 'female', 'f', 'girl'],
};
```

**פונקציה חדשה:**
```typescript
function detectGender(text: string): 'male' | 'female' | undefined {
  // חיפוש עם word boundaries למניעת התאמות חלקיות
  // מחזיר 'male', 'female', או undefined
}
```

**עדכון `parseLine()`:**
- קריאה ל-`detectGender()`
- הסרת מילות מפתח של מגדר מהשם
- החזרת `gender` ב-result

### 2. `TextPasteArea.tsx`

עדכון הדוגמאות והוראות:
```tsx
// דוגמה חדשה:
משה כהן 15/03/1990 זכר
שרה לוי 22.05.85 נקבה כן
דוד בן ישראלי 10/12/1985 male
```

### 3. תרגומים (he.json, en.json)

- `pasteInstructionGender` - הסבר על זיהוי מגדר
- `pasteInstructionSunset` - עדכון להסביר על "כן/לא"
- `pastePlaceholder` - דוגמאות מעודכנות

## היגיון החכם

### זיהוי מגדר:
1. **Word boundaries** - `\b${keyword}\b` מונע התאמה של "נקבה" ב-"נקבהמשפחה"
2. **Case insensitive** - עובד גם עם "זכר" וגם "זכר"
3. **קדימות** - זכר נבדק קודם, אחר כך נקבה
4. **אופציונלי** - אם לא נמצא, `undefined` (לא חובה)

### "כן/לא":
1. **ברירת מחדל: לא** - אם לא כותבים כלום, afterSunset=false
2. **"כן"/"yes"** - מילים פשוטות וברורות
3. **תאימות לאחור** - מילות מפתח ישנות עדיין עובדות
4. **גמישות** - אפשר גם "בלילה", "ערב", וכו'

## הסרת מילות מפתח

המערכת **מסירה אוטומטית** את מילות המפתח מהשם:

```
Input:  "משה כהן זכר כן 15/03/1990"
        ↓
Remove: תאריך, "זכר", "כן"
        ↓
Output: שם: "משה כהן"
        מגדר: male
        afterSunset: true
```

## קבצים ששונו

1. ✅ `v3cv2/src/utils/textParser.ts`
   - הוספת `GENDER_KEYWORDS`
   - עדכון `AFTER_SUNSET_KEYWORDS`
   - פונקציה חדשה: `detectGender()`
   - עדכון `parseLine()`

2. ✅ `v3cv2/src/components/import/TextPasteArea.tsx`
   - עדכון דוגמאות
   - עדכון הוראות

3. ✅ `v3cv2/src/locales/he.json`
   - תרגומים מעודכנים

4. ✅ `v3cv2/src/locales/en.json`
   - תרגומים מעודכנים

## תוצאה

משתמשים יכולים עכשיו:
- ✅ לכתוב "נקבה"/"זכר" או "female"/"male" בכל מקום בשורה
- ✅ לכתוב "כן"/"yes" בצורה פשוטה לאחרי שקיעה
- ✅ להשתמש בקיצורים: "ז", "נ", "m", "f"
- ✅ להשאיר ברירת מחדל (לא) ללא כתיבה
- ✅ לשלב הכל בשורה אחת

**הזיהוי חכם, גמיש ואינטואיטיבי!** 🎉

